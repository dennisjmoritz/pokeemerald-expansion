mapscripts Route119_WeatherInstitute_2F_MapScripts {
    Route119_WeatherInstitute_2F_OnTransition
}

script Route119_WeatherInstitute_2F_EventScript_SetScientistPosAquaHere {
	setobjectxyperm LOCALID_WEATHER_INSTITUTE_2F_SCIENTIST, 1, 6
	setobjectmovementtype LOCALID_WEATHER_INSTITUTE_2F_SCIENTIST, MOVEMENT_TYPE_FACE_RIGHT
	return

}

script Route119_WeatherInstitute_2F_EventScript_SetScientistPosAquaGone {
	setobjectxyperm LOCALID_WEATHER_INSTITUTE_2F_SCIENTIST, 4, 6
	setobjectmovementtype LOCALID_WEATHER_INSTITUTE_2F_SCIENTIST, MOVEMENT_TYPE_FACE_RIGHT
	return

}

script Route119_WeatherInstitute_2F_EventScript_SetScientistPosGameClear {
	setobjectxyperm LOCALID_WEATHER_INSTITUTE_2F_SCIENTIST, 2, 2
	setobjectmovementtype LOCALID_WEATHER_INSTITUTE_2F_SCIENTIST, MOVEMENT_TYPE_FACE_UP
	return

}

script Route119_WeatherInstitute_2F_EventScript_Grunt5 {
	trainerbattle_single TRAINER_GRUNT_WEATHER_INST_5, Route119_WeatherInstitute_2F_Text_Grunt5Intro, Route119_WeatherInstitute_2F_Text_Grunt5Defeat
	msgbox Route119_WeatherInstitute_2F_Text_Grunt5PostBattle, MSGBOX_AUTOCLOSE
	end

}

script Route119_WeatherInstitute_2F_EventScript_Grunt2 {
	trainerbattle_single TRAINER_GRUNT_WEATHER_INST_2, Route119_WeatherInstitute_2F_Text_Grunt2Intro, Route119_WeatherInstitute_2F_Text_Grunt2Defeat
	msgbox Route119_WeatherInstitute_2F_Text_Grunt2PostBattle, MSGBOX_AUTOCLOSE
	end

}

script Route119_WeatherInstitute_2F_EventScript_Grunt3 {
	trainerbattle_single TRAINER_GRUNT_WEATHER_INST_3, Route119_WeatherInstitute_2F_Text_Grunt3Intro, Route119_WeatherInstitute_2F_Text_Grunt3Defeat
	msgbox Route119_WeatherInstitute_2F_Text_Grunt3PostBattle, MSGBOX_AUTOCLOSE
	end

}

script Route119_WeatherInstitute_2F_EventScript_Shelly {
	trainerbattle_single TRAINER_SHELLY_WEATHER_INSTITUTE, Route119_WeatherInstitute_2F_Text_ShellyIntro, Route119_WeatherInstitute_2F_Text_ShellyDefeat, Route119_WeatherInstitute_2F_EventScript_ShellyDefeated
	msgbox Route119_WeatherInstitute_2F_Text_ShellyPostBattle, MSGBOX_AUTOCLOSE
	end

}

script Route119_WeatherInstitute_2F_EventScript_ShellyDefeated {
	msgbox Route119_WeatherInstitute_2F_Text_ShellyPostBattle, MSGBOX_DEFAULT
	closemessage
	addobject LOCALID_WEATHER_INSTITUTE_2F_GRUNT_3
	applymovement LOCALID_WEATHER_INSTITUTE_2F_GRUNT_3, Route119_WeatherInstitute_2F_Movement_GruntApproachShelly
	applymovement LOCALID_PLAYER, Route119_WeatherInstitute_2F_Movement_ShovePlayerOutOfWay
	waitmovement 0
	msgbox Route119_WeatherInstitute_2F_Text_TeamMagmaJustPassedBy, MSGBOX_DEFAULT
	closemessage
	playse SE_PIN
	applymovement LOCALID_WEATHER_INSTITUTE_2F_SHELLY, Common_Movement_ExclamationMark
	waitmovement 0
	applymovement LOCALID_WEATHER_INSTITUTE_2F_SHELLY, Common_Movement_Delay48
	waitmovement 0
	msgbox Route119_WeatherInstitute_2F_Text_WeHaveToHurryToMtPyre, MSGBOX_DEFAULT
	closemessage
	setvar VAR_WEATHER_INSTITUTE_STATE, 1
	clearflag FLAG_HIDE_WEATHER_INSTITUTE_2F_WORKERS
	fadedefaultbgm
	fadescreen FADE_TO_BLACK
	setflag FLAG_HIDE_ROUTE_119_TEAM_AQUA
	setflag FLAG_HIDE_WEATHER_INSTITUTE_2F_AQUA_GRUNT_M
	removeobject LOCALID_WEATHER_INSTITUTE_2F_GRUNT_1
	removeobject LOCALID_WEATHER_INSTITUTE_2F_GRUNT_2
	removeobject LOCALID_WEATHER_INSTITUTE_2F_SHELLY
	removeobject LOCALID_WEATHER_INSTITUTE_2F_GRUNT_4
	removeobject LOCALID_WEATHER_INSTITUTE_2F_GRUNT_3
	applymovement LOCALID_PLAYER, Route119_WeatherInstitute_2F_Movement_PlayerReturnToPosition
	waitmovement 0
	fadescreen FADE_FROM_BLACK
	applymovement LOCALID_WEATHER_INSTITUTE_2F_SCIENTIST, Route119_WeatherInstitute_2F_Movement_ScientistApproachPlayer
	waitmovement 0
	copyobjectxytoperm LOCALID_WEATHER_INSTITUTE_2F_SCIENTIST
	goto Route119_WeatherInstitute_2F_EventScript_ReceiveCastform
	end

}

script Route119_WeatherInstitute_2F_EventScript_ReceiveCastform {
	msgbox Route119_WeatherInstitute_2F_Text_ThanksPleaseTakePokemon, MSGBOX_DEFAULT
	setvar VAR_TEMP_TRANSFERRED_SPECIES, SPECIES_CASTFORM_NORMAL
	givemon SPECIES_CASTFORM_NORMAL, 25, ITEM_MYSTIC_WATER
	goto_if_eq VAR_RESULT, MON_GIVEN_TO_PARTY, Route119_WeatherInstitute_2F_EventScript_ReceiveCastformParty
	goto_if_eq VAR_RESULT, MON_GIVEN_TO_PC, Route119_WeatherInstitute_2F_EventScript_ReceiveCastformPC
// FIXME undefined reference: 	goto Common_EventScript_NoMoreRoomForPokemon
	end

}

script Route119_WeatherInstitute_2F_EventScript_ReceiveCastformParty {
	call Route119_WeatherInstitute_2F_EventScript_ReceivedCastformFanfare
	msgbox gText_NicknameThisPokemon, MSGBOX_YESNO
	goto_if_eq VAR_RESULT, NO, Route119_WeatherInstitute_2F_EventScript_ExplainCastform
// FIXME undefined reference: 	call Common_EventScript_GetGiftMonPartySlot
	call Common_EventScript_NameReceivedPartyMon
	goto Route119_WeatherInstitute_2F_EventScript_ExplainCastform
	end

}

script Route119_WeatherInstitute_2F_EventScript_ReceiveCastformPC {
	call Route119_WeatherInstitute_2F_EventScript_ReceivedCastformFanfare
	msgbox gText_NicknameThisPokemon, MSGBOX_YESNO
	goto_if_eq VAR_RESULT, NO, Route119_WeatherInstitute_2F_EventScript_SendCastformToPC
// FIXME undefined reference: 	call Common_EventScript_NameReceivedBoxMon
	goto Route119_WeatherInstitute_2F_EventScript_SendCastformToPC
	end

}

script Route119_WeatherInstitute_2F_EventScript_SendCastformToPC {
// FIXME undefined reference: 	call Common_EventScript_TransferredToPC
	goto Route119_WeatherInstitute_2F_EventScript_ExplainCastform
	end

}

script Route119_WeatherInstitute_2F_EventScript_ReceivedCastformFanfare {
	playfanfare MUS_OBTAIN_ITEM
	message Route119_WeatherInstitute_2F_Text_PlayerReceivedCastform
	waitmessage
	waitfanfare
	bufferspeciesname STR_VAR_1, SPECIES_CASTFORM_NORMAL
	return

}

script Route119_WeatherInstitute_2F_EventScript_ExplainCastform {
	msgbox Route119_WeatherInstitute_2F_Text_PokemonChangesWithWeather, MSGBOX_DEFAULT
	setflag FLAG_RECEIVED_CASTFORM
	release
	end

}

script Route119_WeatherInstitute_2F_EventScript_ScientistMentionWeather {
	goto_if_set FLAG_SYS_GAME_CLEAR, Route119_WeatherInstitute_2F_EventScript_TryStartAbnormalWeather
	msgbox Route119_WeatherInstitute_2F_Text_ChangingWeatherRidiculous, MSGBOX_DEFAULT
	release
	end

}

script Route119_WeatherInstitute_2F_EventScript_TryStartAbnormalWeather {
	setvar VAR_0x8004, 0
	call_if_set FLAG_DEFEATED_KYOGRE, Route119_WeatherInstitute_2F_EventScript_LegendaryDefeated
	call_if_set FLAG_DEFEATED_GROUDON, Route119_WeatherInstitute_2F_EventScript_LegendaryDefeated
	goto_if_eq VAR_0x8004, 2, Route119_WeatherInstitute_2F_EventScript_NoAbnormalWeather  @ Both defeated
	call_if_unset FLAG_TEMP_2, Route119_WeatherInstitute_2F_EventScript_CreateAbnormalWeather
	specialvar VAR_RESULT, GetAbnormalWeatherMapNameAndType
	goto_if_eq VAR_RESULT, 1, Route119_WeatherInstitute_2F_EventScript_KyogreWeather
	msgbox Route119_WeatherInstitute_2F_Text_GroudonWeather, MSGBOX_DEFAULT
	release
	end

}

script Route119_WeatherInstitute_2F_EventScript_KyogreWeather {
	msgbox Route119_WeatherInstitute_2F_Text_KyogreWeather, MSGBOX_DEFAULT
	release
	end

}

script Route119_WeatherInstitute_2F_EventScript_CreateAbnormalWeather {
	special CreateAbnormalWeatherEvent
	setflag FLAG_TEMP_2
	return

}

script Route119_WeatherInstitute_2F_EventScript_LegendaryDefeated {
	addvar VAR_0x8004, 1
	return

}

script Route119_WeatherInstitute_2F_EventScript_NoAbnormalWeather {
	msgbox Route119_WeatherInstitute_2F_Text_NoAbnormalWeather, MSGBOX_DEFAULT
	release
	end

}

script Route119_WeatherInstitute_2F_EventScript_WeatherScientist {
	lock
	faceplayer
	goto_if_set FLAG_RECEIVED_CASTFORM, Route119_WeatherInstitute_2F_EventScript_ScientistMentionWeather
	goto Route119_WeatherInstitute_2F_EventScript_ReceiveCastform
	end

}

text Route119_WeatherInstitute_2F_Text_Grunt2Intro {
    format("The INSTITUTE created a type of POKéMON that has something to do with\l the weather. We're here to take them!")
}

text Route119_WeatherInstitute_2F_Text_Grunt2Defeat {
    format("Our plan's being spoiled by a kid?")
}

text Route119_WeatherInstitute_2F_Text_Grunt2PostBattle {
    format("If the POKéMON they made here can control the weather freely, then we of\l TEAM AQUA definitely need it!")
}

text Route119_WeatherInstitute_2F_Text_Grunt3Intro {
    format("We're TEAM AQUA! We appear wherever anything rare is\l found!")
}

text Route119_WeatherInstitute_2F_Text_Grunt3Defeat {
    format("You got me!")
}

text Route119_WeatherInstitute_2F_Text_Grunt3PostBattle {
    format("You don't have any idea what we of TEAM AQUA are working towards!\l You stay out of our way!")
}

text Route119_WeatherInstitute_2F_Text_Grunt5Intro {
    format("Don't tell me you're looking for that weather POKéMON, too?\p That's a no-no! We were here to get it first!")
}

text Route119_WeatherInstitute_2F_Text_Grunt5Defeat {
    format("Oh, will you look at my POKéMON?")
}

text Route119_WeatherInstitute_2F_Text_Grunt5PostBattle {
    format("Humph, so what? What we want…\p What we really want isn't here… Ihihihihi…")
}

text Route119_WeatherInstitute_2F_Text_ShellyIntro {
    format("Ahahahaha!\p You're going to meddle in TEAM AQUA's affairs?\p You're either absolutely fearless, simply ignorant, or both!\p You're so cute, you're disgusting! I'll put you down, kiddy!")
}

text Route119_WeatherInstitute_2F_Text_ShellyDefeat {
    format("Ahahahaha! You're disgustingly strong!")
}

text Route119_WeatherInstitute_2F_Text_ShellyPostBattle {
    format("It's bad enough to have TEAM MAGMA blunder about, but now there's you!\p What makes you want to sniff around in our business, anyway?")
}

text Route119_WeatherInstitute_2F_Text_TeamMagmaJustPassedBy {
    format("We have a situation here!\p A TEAM MAGMA mob just passed the WEATHER INSTITUTE.\p They appear to be headed for MT. PYRE!")
}

text Route119_WeatherInstitute_2F_Text_WeHaveToHurryToMtPyre {
    format("What?!\p We can't waste any more time here! We have to hurry to MT. PYRE, too!\p Ahahahaha! TEAM MAGMA, just you wait!")
}

text Route119_WeatherInstitute_2F_Text_ThanksPleaseTakePokemon {
    format("Thanks! Thanks to you, we're safe!\p It might be an odd way of thanking you, but take this POKéMON.")
}

text Route119_WeatherInstitute_2F_Text_NoRoomForPokemon {
    format("Hm? You don't seem to have any room for this POKéMON.")
}

text Route119_WeatherInstitute_2F_Text_PlayerReceivedCastform {
    format("{PLAYER} received CASTFORM!")
}

text Route119_WeatherInstitute_2F_Text_PokemonChangesWithWeather {
    format("That POKéMON changes shape according to the weather conditions.\p There're plenty of them in the INSTITUTE--go ahead and take it.")
}

text Route119_WeatherInstitute_2F_Text_ChangingWeatherRidiculous {
    format("I've been researching rain for many years, but it's ridiculous to think that\l humans can freely change the weather.")
}

text Route119_WeatherInstitute_2F_Text_GroudonWeather {
    format("I track weather patterns over the HOENN region.\p Presently, a drought has been recorded in {STR_VAR_1}.\p Could that mean, somewhere near {STR_VAR_1}…")
}

text Route119_WeatherInstitute_2F_Text_KyogreWeather {
    format("I track weather patterns over the HOENN region.\p Presently, heavy rainfall has been recorded over {STR_VAR_1}.\p Could that mean, somewhere near {STR_VAR_1}…")
}

text Route119_WeatherInstitute_2F_Text_NoAbnormalWeather {
    format("Abnormal weather conditions are no longer being reported.\p The occasional rainfall is a blessing, really.")
}

