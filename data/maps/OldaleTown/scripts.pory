#events for OldaleTown

script OldaleTown_MapScripts {
	map_script MAP_SCRIPT_ON_TRANSITION, OldaleTown_OnTransition
	.byte 0

}

script OldaleTown_EventScript_SetOldaleState {
	setvar VAR_OLDALE_TOWN_STATE, 1
	return

}

script OldaleTown_EventScript_BlockWestEntrance {
	setobjectxyperm LOCALID_FOOTPRINTS_MAN, 1, 11
	setobjectmovementtype LOCALID_FOOTPRINTS_MAN, MOVEMENT_TYPE_FACE_LEFT
	return

}

script OldaleTown_EventScript_MoveMartEmployee {
	setobjectxyperm LOCALID_OLDALE_MART_EMPLOYEE, 13, 14
	setobjectmovementtype LOCALID_OLDALE_MART_EMPLOYEE, MOVEMENT_TYPE_FACE_DOWN
	return

}

script OldaleTown_EventScript_TownSign {
	msgbox OldaleTown_Text_TownSign, MSGBOX_SIGN
	end

}

script OldaleTown_EventScript_Girl {
	msgbox OldaleTown_Text_SavingMyProgress, MSGBOX_NPC
	end

}

script OldaleTown_EventScript_MartEmployee {
	lock
	faceplayer
	goto_if_set FLAG_RECEIVED_POTION_OLDALE, OldaleTown_EventScript_ExplainPotion
	goto_if_set FLAG_TEMP_1, OldaleTown_EventScript_ExplainPotion
	setflag FLAG_TEMP_1
	playbgm MUS_FOLLOW_ME, FALSE
	msgbox OldaleTown_Text_IWorkAtPokemonMart, MSGBOX_DEFAULT
	closemessage
	switch VAR_FACING
	case DIR_SOUTH, OldaleTown_EventScript_GoToMartSouth
	case DIR_NORTH, OldaleTown_EventScript_GoToMartNorth
	case DIR_EAST, OldaleTown_EventScript_GoToMartEast
	end

}

script OldaleTown_EventScript_GoToMartSouth {
	applymovement LOCALID_OLDALE_MART_EMPLOYEE, OldaleTown_Movement_EmployeeSouth
	applymovement LOCALID_PLAYER, OldaleTown_Movement_PlayerSouth
	waitmovement 0
	goto OldaleTown_EventScript_ExplainPokemonMart
	end

}

script OldaleTown_EventScript_GoToMartNorth {
	applymovement LOCALID_OLDALE_MART_EMPLOYEE, OldaleTown_Movement_EmployeeNorth
	applymovement LOCALID_PLAYER, OldaleTown_Movement_PlayerNorth
	waitmovement 0
	goto OldaleTown_EventScript_ExplainPokemonMart
	end

}

script OldaleTown_EventScript_GoToMartEast {
	applymovement LOCALID_PLAYER, OldaleTown_Movement_PlayerEast
	applymovement LOCALID_OLDALE_MART_EMPLOYEE, OldaleTown_Movement_EmployeeEast
	waitmovement 0
	goto OldaleTown_EventScript_ExplainPokemonMart
	end

}

script OldaleTown_EventScript_ExplainPokemonMart {
	msgbox OldaleTown_Text_ThisIsAPokemonMart, MSGBOX_DEFAULT
	giveitem ITEM_POTION
// FIXME undefined reference: 	goto_if_eq VAR_RESULT, FALSE, OldaleTown_EventScript_BagIsFull
	msgbox OldaleTown_Text_PotionExplanation, MSGBOX_DEFAULT
	setflag FLAG_RECEIVED_POTION_OLDALE
	fadedefaultbgm
	release
	end

}

script OldaleTown_EventScript_ExplainPotion {
	msgbox OldaleTown_Text_PotionExplanation, MSGBOX_DEFAULT
	release
	end

// FIXME undefined reference: OldaleTown_EventScript_BagIsFull::
	msgbox gText_TooBadBagIsFull, MSGBOX_DEFAULT
	fadedefaultbgm
	release
	end

}

script OldaleTown_EventScript_FootprintsMan {
	lock
	faceplayer
	goto_if_set FLAG_ADVENTURE_STARTED, OldaleTown_EventScript_NotBlockingPath
	msgbox OldaleTown_Text_DiscoveredFootprints, MSGBOX_DEFAULT
	closemessage
	applymovement LOCALID_FOOTPRINTS_MAN, Common_Movement_FaceOriginalDirection
	waitmovement 0
	release
	end

}

script OldaleTown_EventScript_BlockedPath {
	lockall
	applymovement LOCALID_PLAYER, OldaleTown_Movement_PlayerStepBack
	applymovement LOCALID_FOOTPRINTS_MAN, OldaleTown_Movement_BackUp
	waitmovement 0
	msgbox OldaleTown_Text_WaitDontComeInHere, MSGBOX_DEFAULT
	closemessage
	applymovement LOCALID_FOOTPRINTS_MAN, OldaleTown_Movement_ReturnToOriginalPosition
	waitmovement 0
	releaseall
	end

}

script OldaleTown_EventScript_NotBlockingPath {
	msgbox OldaleTown_Text_FinishedSketchingFootprints, MSGBOX_DEFAULT
	release
	end

}

script OldaleTown_EventScript_Rival {
	lockall
	applymovement LOCALID_OLDALE_RIVAL, Common_Movement_FacePlayer
	waitmovement 0
	setvar VAR_0x8009, 0
	goto OldaleTown_EventScript_ShowRivalMessage
	end

}

script OldaleTown_EventScript_RivalTrigger1 {
	lockall
	applymovement LOCALID_OLDALE_RIVAL, OldaleTown_Movement_RivalApproachPlayer1
	waitmovement 0
	applymovement LOCALID_PLAYER, Common_Movement_WalkInPlaceFasterRight
	waitmovement 0
	setvar VAR_0x8009, 1
	goto OldaleTown_EventScript_ShowRivalMessage
	end

}

script OldaleTown_EventScript_RivalTrigger2 {
	lockall
	applymovement LOCALID_OLDALE_RIVAL, OldaleTown_Movement_RivalApproachPlayer2
	waitmovement 0
	applymovement LOCALID_PLAYER, Common_Movement_WalkInPlaceFasterRight
	waitmovement 0
	setvar VAR_0x8009, 1
	goto OldaleTown_EventScript_ShowRivalMessage
	end

}

script OldaleTown_EventScript_RivalTrigger3 {
	lockall
	applymovement LOCALID_OLDALE_RIVAL, OldaleTown_Movement_RivalApproachPlayer3
	waitmovement 0
	applymovement LOCALID_PLAYER, Common_Movement_WalkInPlaceFasterRight
	waitmovement 0
	setvar VAR_0x8009, 1
	goto OldaleTown_EventScript_ShowRivalMessage
	end

}

script OldaleTown_EventScript_ShowRivalMessage {
	checkplayergender
	goto_if_eq VAR_RESULT, MALE, OldaleTown_EventScript_ShowMayMessage
	goto_if_eq VAR_RESULT, FEMALE, OldaleTown_EventScript_ShowBrendanMessage
	end

}

script OldaleTown_EventScript_ShowMayMessage {
	msgbox OldaleTown_Text_MayLetsGoBack, MSGBOX_DEFAULT
	goto OldaleTown_EventScript_RivalFinish
	end

}

script OldaleTown_EventScript_ShowBrendanMessage {
	msgbox OldaleTown_Text_BrendanLetsGoBack, MSGBOX_DEFAULT
	goto OldaleTown_EventScript_RivalFinish
	end

}

script OldaleTown_EventScript_RivalFinish {
	closemessage
	call_if_eq VAR_0x8009, 0, OldaleTown_EventScript_DoExitMovement1
	call_if_eq VAR_0x8009, 1, OldaleTown_EventScript_DoExitMovement2
	applymovement LOCALID_OLDALE_RIVAL, OldaleTown_Movement_RivalExit
	waitmovement 0
	removeobject LOCALID_OLDALE_RIVAL
	setvar VAR_OLDALE_RIVAL_STATE, 2
	setflag FLAG_HIDE_OLDALE_TOWN_RIVAL
	releaseall
	end

}

script OldaleTown_EventScript_DoExitMovement1 {
	goto_if_ne VAR_FACING, DIR_SOUTH, OldaleTown_EventScript_DoExitMovement2
	applymovement LOCALID_OLDALE_RIVAL, OldaleTown_Movement_RivalExit
	waitmovement 0
	return

}

script OldaleTown_EventScript_DoExitMovement2 {
	applymovement LOCALID_PLAYER, OldaleTown_Movement_WatchRivalExit
	applymovement LOCALID_OLDALE_RIVAL, OldaleTown_Movement_RivalExit
	waitmovement 0
	return

}

text OldaleTown_Text_SavingMyProgress {
    format("I want to take a rest, so I'm saving my progress.")
}

text OldaleTown_Text_IWorkAtPokemonMart {
    format("Hi! I work at a POKéMON MART.\p Can I get you to come with me?")
}

text OldaleTown_Text_ThisIsAPokemonMart {
    format("This is a POKéMON MART. Just look for our blue roof.\p We sell a variety of goods including POKé BALLS for catching POKéMON.\p Here, I'd like you to have this as a promotional item.")
}

text OldaleTown_Text_PotionExplanation {
    format("A POTION can be used anytime, so it's even more useful than a POKéMON CENTER\l in certain situations.")
}

text OldaleTown_Text_WaitDontComeInHere {
    format("Aaaaah! Wait! Please don't come in here.\p I just discovered the footprints of a rare POKéMON!\p Wait until I finish sketching them, okay?")
}

text OldaleTown_Text_DiscoveredFootprints {
    format("I just discovered the footprints of a rare POKéMON!\p Wait until I finish sketching them, okay?")
}

text OldaleTown_Text_FinishedSketchingFootprints {
    format("I finished sketching the footprints of a rare POKéMON.\p But it turns out they were only my own footprints…")
}

text OldaleTown_Text_MayLetsGoBack {
    format("MAY: {PLAYER}{KUN}! Over here!\l Let's hurry home!")
}

text OldaleTown_Text_BrendanLetsGoBack {
    format("BRENDAN: I'm heading back to my dad's LAB now.\l {PLAYER}, you should hustle back, too.")
}

text OldaleTown_Text_TownSign {
    format("OLDALE TOWN “Where things start off scarce.”")
}

